
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
	<head>
		<meta charset="UTF-8">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
		<link rel="stylesheet" href="/css/main.css">
		<title>Carte-O-Culture</title>
	</head>
	<body>
		<div class="title title-page" id="logo">
			<span id="txt-left">Carte -</span>
			<img id="logo-img" src="/img/loupe.jpg" alt="logo_loupe" width="75" height="75">
			<span id="txt-right">- Culture</span>
		</div>

		<div id="box-filter" class="box box-search">
			<!--filtre les points-->
			<form id="filter" action="post">
				<!--<select name="selector-book" id="selector-book"></select>-->
				<!--<textarea name="" id="" cols="30" rows="1">choissisez un livre</textarea>-->
			</form>
		</div>
		<div class="box box-horizontal">
			<!--
			<div class="box box-info">
				<div class="box box-vertical">
					<table>
						<tr>
							<td>Ville 1</td>
							<td>Livre 1</td>
						</tr>
						<tr>
							<td>Ville 2</td>
							<td>Livre 2</td>
						</tr>
						<tr>
							<td>Ville 3</td>
							<td>Livre 3</td>
						</tr>
					</table>
				</div>
			</div>
			-->

			<!--Élément Div pour afficher la carte-->
			<div class="box box-map" id="map"></div>
			<script>
				var map;
				var markers = [];

				// Map functions
				function create_map(div_name) {
					var mapProp= {
						center:new google.maps.LatLng(51.508742,-0.120850),
						zoom:5,
					};
					map = new google.maps.Map(document.getElementById("map"),mapProp);
					return map;
				}

				// Marker functions
				function create_marker(x, y, name, color, map) {
					//x = Math.random()*10+40;
					//y = Math.random()*6+2;
					var LatLng = {lat: x, lng: y};
					console.log(color);
					marker = new google.maps.Marker({
						position: LatLng,
						title: name,
						icon: {url: "http://maps.google.com/mapfiles/ms/icons/"+color+"-dot.png"},
					});
					marker.setMap(map);
					marker.setVisible(false);
					return marker;
				}

				function initMap() {
					create_map("map");
					var livres = [
						{"name":"Manon Lescaut" , "auteur":"Doe"  , "lieux":[{"ville": "Chantilly", "x": 49.19461, "y": 2.47124}, {"ville": "Hesdin", "x": 50.37349, "y": 2.0382}, {"ville": "Jumi\u00e8ges", "x": 49.43324, "y": 0.81918}]},
						{"name":"Les Misérables : Fantine" , "auteur":"Smith", "lieux":[{"ville": "Amiens", "x": 49.9, "y": 2.3}, {"ville": "Calais", "x": 50.95194, "y": 1.85635}]},
						{"name":"Germinal", "auteur":"Jones", "lieux":[{"ville": "Saint-Michel", "x": 49.91952, "y": 4.13278}, {"ville": "Saint-Sulpice", "x": 49.35049, "y": 2.12314}, {"ville": "Versailles", "x": 48.80359, "y": 2.13424}]}
					];

					var x = 0;
					var y = 0;
					var filter = document.getElementById("box-filter");
					var input;		
					var marker;	
					var colors = ["blue","red","yellow"]
					//var pas = Math.ceil(255/livres.length);
					//var decalage = 10;
					//var color_r = 0; var color_g = 0; var color_b = 0; 
					//color = color_r.toString(16)+color_g.toString(16)+color_b.toString(16);	

					for (let i=0; i < livres.length; i++) {
						markers[i] = []
						for(let j=0; j < livres[i]["lieux"].length; j++) {
							x = livres[i]["lieux"][j]["x"];
							y = livres[i]["lieux"][j]["y"];
							name = livres[i]["lieux"][j]["name"];
							marker = create_marker(x,y,name,colors[i],map);
							markers[i].push(marker)
						}
						
						input = document.createElement("input");
						input.setAttribute('type', 'checkbox');
						input.setAttribute("id", "box_livre_"+i);
						input.setAttribute("class", "input input-livre"+i);
						input.setAttribute('onclick',"toggle_marker(this,"+i+")");

						label = document.createElement("label");
						label.innerHTML = livres[i]["name"];  

						div = document.createElement("div");
						div.setAttribute("class", "div_input_livre");

						label.appendChild(input);
						div.appendChild(label);
						filter.appendChild(div);					
					}	
					input = document.createElement("submit");
					filter.appendChild(input);									
				}

				function toggle_marker(box,i) {
					if (box.checked) {
						console.log(markers[i]);
						for(let j=0; j < markers[i].length; j++) {
							markers[i][j].setVisible(true);
						}
					} else {
						for(let j=0; j < markers[i].length; j++) {
							markers[i][j].setVisible(false);
						}
					}
				}

			</script>
			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAoBbN_BhqAdAJ1T4t3f09861MMwjBbJ6Q&callback=initMap" defer></script>
		</div>
		<footer>
			Projet DevOps Master 2022			
		</footer>
	</body>
</html>